---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: &app yt-dlp-jon-ong
  namespace: scripts
  labels:
    app: *app
spec:
  schedule: '30 17 * * *'
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        spec:
          automountServiceAccountToken: false
          containers:
            - name: *app
              image: ghcr.io/truxnell/yt-dlp:2023.10.13@sha256:8b0af73e4705ff4dda9afd0a71031469a6b0cc5dec3ae0d4739b55e5dd5cbd25
              imagePullPolicy: IfNotPresent
              command: ['/wrapper.sh']
              args:
                - -f
                - ba
                - https://www.youtube.com/c/JonathanOng/videos
                - --remux-video
                - opus
                - -o
                - /music/Jonathan Ong/Twitch Highlights/%(title)s.%(ext)s
                - --download-archive
                - /music/Jonathan Ong/Twitch Highlights/ytdlhistory.txt
                - --add-metadata
                - --embed-thumbnail
                - --parse-metadata
                - Twitch Highlights:%(meta_album)s
                - --parse-metadata
                - Jonathan Ong:%(meta_artist)s
                - --parse-metadata
                - Jonathan Ong:%(meta_album_artist)s
              volumeMounts:
                - mountPath: /music
                  name: nas
          restartPolicy: Never
          volumes:
            - name: nas
              nfs:
                server: 'helios.${INTERNAL_DOMAIN}'
                path: /tank/natflix/music/
